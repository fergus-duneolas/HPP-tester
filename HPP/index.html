<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HPP Return Catcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- If you're testing inside an iframe, try to pop to top window -->
  <script>
    // 1) If we land inside an iframe, try to break out so you can see the page.
    (function ensureTopNav() {
      try {
        if (window.top !== window.self) {
          window.top.location.href = window.location.href; // attempt top-level navigation
        }
      } catch (e) { /* cross-origin; ignore */ }
    })();

    // 2) OPTIONAL: immediately bounce to your backend (keep query params)
    // e.g., const AUTO_REDIRECT_TO = "https://your.app/payments/return";
    const AUTO_REDIRECT_TO = ""; // set to your backend URL to auto-redirect
    (function maybeBounce() {
      if (AUTO_REDIRECT_TO) {
        const sep = AUTO_REDIRECT_TO.includes("?") ? "&" : "?";
        const target = AUTO_REDIRECT_TO + sep + window.location.search.slice(1);
        // Use replace() so the HPP page isn't in the history stack
        window.location.replace(target);
      }
    })();
  </script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; line-height: 1.4; }
    code, pre { background: #f4f4f4; padding: .5rem; border-radius: .5rem; }
    .kv { display: grid; grid-template-columns: 220px 1fr; gap: .5rem 1rem; }
    .kv div { padding: .25rem 0; }
    .ok { color: #0a7a25; } .warn { color: #b35a00; }
  </style>
</head>
<body>
  <h1>HPP Return Catcher</h1>
  <p class="ok">Youâ€™ve been redirected back from Global Payments HPP.</p>

  <h2>Full URL</h2>
  <pre id="full"></pre>

  <h2>Query Parameters</h2>
  <div class="kv" id="params"></div>

  <h2>Tips</h2>
  <ul>
    <li>Look for a transaction id param (often <code>TRN_ID</code>, <code>transaction_id</code>, or similar).</li>
    <li>Use that id on your backend to call <code>GET /ucp/transactions/{TRN_ID}</code> and confirm status.</li>
    <li>If you want to bounce to your backend automatically, set <code>AUTO_REDIRECT_TO</code> in the script.</li>
  </ul>

  <script>
    const outFull = document.getElementById('full');
    const outParams = document.getElementById('params');
    outFull.textContent = window.location.href;

    const qp = new URLSearchParams(window.location.search);
    if ([...qp.keys()].length === 0) {
      outParams.innerHTML = '<div class="warn">No query parameters present.</div>';
    } else {
      const frag = document.createDocumentFragment();
      qp.forEach((v, k) => {
        const kEl = document.createElement('div'); kEl.innerHTML = `<code>${k}</code>`;
        const vEl = document.createElement('div'); vEl.textContent = v;
        frag.appendChild(kEl); frag.appendChild(vEl);
      });
      outParams.appendChild(frag);
    }
  </script>
</body>
</html>
